generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["relationJoins"]
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id             String  @id @default(uuid())
  username       String  @unique
  fullName       String
  hashedPassword String
  imgUrl         String?

  mealPlans          ChosenMeal[]
  createdMeals       Meal[]
  createdIngredients Ingredient[]
  userPhysicalStat   UserPhysicalStat?
}

model UserPhysicalStat {
  id         String     @id @default(uuid())
  age        Int
  gender     gender
  height     Float
  heightUnit heightUnit @default(cm)
  weightInKg Float
  tdee       Int

  activityLevel   ActivityLevel? @relation(fields: [activityLevelId], references: [id])
  activityLevelId Int
  user            User           @relation(fields: [userId], references: [id])
  userId          String         @unique
}

model ActivityLevel {
  id                Int    @id @default(autoincrement())
  activityLevelType String @unique

  userPhysicalStats UserPhysicalStat[]
}

model ChosenMeal {
  id          String   @id @default(uuid())
  mealTime    mealTime
  quantity    Float
  appliedDate DateTime

  meal   Meal   @relation(fields: [mealId], references: [id])
  mealId Int
  users  User?  @relation(fields: [userId], references: [id])
  userId String

  @@unique([userId, mealTime, appliedDate])
}

model Meal {
  id       Int      @id @default(autoincrement())
  mealName String   @unique
  mealType mealType @default(food)
  imgURL   String?

  createdBy String?
  user      User?   @relation(fields: [createdBy], references: [id])

  ingredients MealIngredient[]
  chosenMeals ChosenMeal[]
}

model MealIngredient {
  id              Int            @id @default(autoincrement())
  ingredientValue Float
  ingredientUnit  ingredientUnit @default(g)

  ingredientUnitCovert IngredientUnitCovert @relation(fields: [ingredientUnit], references: [ingredientUnit])
  meal                 Meal                 @relation(fields: [mealId], references: [id])
  mealId               Int
  ingredient           Ingredient           @relation(fields: [ingredientId], references: [id])
  ingredientId         Int

  @@unique([mealId, ingredientId])
}

model IngredientUnitCovert {
  ingredientUnit ingredientUnit @id
  covertToGrams  Float

  mealIngredients MealIngredient[]
}

model Ingredient {
  id             Int             @id @default(autoincrement())
  ingredientName String
  ingredientType ingredientType?

  createdBy String?
  user      User?   @relation(fields: [createdBy], references: [id])

  nutrients IngredientNutrient[]
  meals     MealIngredient[]
}

model IngredientNutrient {
  id                  Int   @id @default(autoincrement())
  nutrientValueOn100g Float

  ingredient   Ingredient @relation(fields: [ingredientId], references: [id])
  ingredientId Int
  nutrient     Nutrient   @relation(fields: [nutrientId], references: [id])
  nutrientId   Int

  @@unique([ingredientId, nutrientId])
}

model Nutrient {
  id           Int          @id @default(autoincrement())
  nutrientName String       @unique
  nutrientType nutrientType @default(macro)
  nutrientUnit nutrientUnit @default(g)

  ingredients IngredientNutrient[]
}

enum nutrientType {
  macro
  micro
}

enum nutrientUnit {
  kCal
  g
  mg
  mcg
}

enum mealTime {
  breakfast
  lunch
  dinner
  snack
}

enum mealType {
  food
  fruit
  drink
  snack
}

enum gender {
  male
  female
  other
}

enum heightUnit {
  m
  cm
}

enum ingredientUnit {
  g
  tbsp // 18g
  tsp // 6g
  cup // 292g
  dash // 0.4g
}

enum ingredientType {
  meat
  vegetable
  milk
  nut
  fruit
  oil
  seafood
  spice
  candy
  beverage
  bread
  other
}

enum activityLevel {
  low
  medium
  high
}
